(function($){$(document).ready(function(){$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom()});function format(a){for(var i=1;i<arguments.length;i++){a=a.replace('%'+(i-1),arguments[i])}return a}function CloudZoom(i,j){var k=$('img',i);var l;var m;var n=null;var o=null;var p=null;var q=null;var r=null;var s=null;var t;var u=0;var v,ch;var z=0;var A=0;var B=0;var C=0;var D=0;var E,my;var F=this,zw;setTimeout(function(){if(o===null){var w=i.width();i.parent().append(format('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',w/3,(w/2)-(w/6))).find(':last').css('opacity',0.5)}},200);var G=function(){if(s!==null){s.remove();s=null}};this.removeBits=function(){if(p){p.remove();p=null}if(q){q.remove();q=null}if(r){r.remove();r=null}G();$('.cloud-zoom-loading',i.parent()).remove()};this.destroy=function(){i.data('zoom',null);if(o){o.unbind();o.remove();o=null}if(n){n.remove();n=null}this.removeBits()};this.fadedOut=function(){if(n){n.remove();n=null}this.removeBits()};this.controlLoop=function(){if(p){var x=(E-k.offset().left-(v*0.5))>>0;var y=(my-k.offset().top-(ch*0.5))>>0;if(x<0){x=0}else if(x>(k.outerWidth()-v)){x=(k.outerWidth()-v)}if(y<0){y=0}else if(y>(k.outerHeight()-ch)){y=(k.outerHeight()-ch)}p.css({left:x,top:y});p.css('background-position',(-x)+'px '+(-y)+'px');z=(((x)/k.outerWidth())*t.width)>>0;A=(((y)/k.outerHeight())*t.height)>>0;C+=(z-C)/j.smoothMove;B+=(A-B)/j.smoothMove;n.css('background-position',(-(C>>0)+'px ')+(-(B>>0)+'px'))}u=setTimeout(function(){F.controlLoop()},30)};this.init2=function(a,b){D++;if(b===1){t=a}if(D===2){this.init()}};this.init=function(){$('.cloud-zoom-loading',i.parent()).remove();o=i.parent().append(format("<div class='mousetrap' style='background-image:url(\""+j.transparentImage+"\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;\'></div>",k.outerWidth(),k.outerHeight(),0,0)).find(':last');o.bind('mousemove',this,function(a){E=a.pageX;my=a.pageY});o.bind('mouseleave',this,function(a){clearTimeout(u);if(p){p.fadeOut(299)}if(q){q.fadeOut(299)}if(r){r.fadeOut(299)}n.fadeOut(300,function(){F.fadedOut()});return false});o.bind('mouseenter',this,function(a){E=a.pageX;my=a.pageY;zw=a.data;if(n){n.stop(true,false);n.remove()}var b=j.adjustX,yPos=j.adjustY;var c=k.outerWidth();var d=k.outerHeight();var w=j.zoomWidth;var h=j.zoomHeight;if(j.zoomWidth=='auto'){w=c}if(j.zoomHeight=='auto'){h=d}var e=i.parent();switch(j.position){case'top':yPos-=h;break;case'right':b+=c;break;case'bottom':yPos+=d;break;case'left':b-=w;break;case'inside':w=c;h=d;break;default:e=$('#'+j.position);if(!e.length){e=i;b+=c;yPos+=d}else{w=e.innerWidth();h=e.innerHeight()}}n=e.append(format('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>',b,yPos,w,h,t.src)).find(':last');if(k.attr('title')&&j.showTitle){n.append(format('<div class="cloud-zoom-title">%0</div>',k.attr('title'))).find(':last').css('opacity',j.titleOpacity)}var f=/(msie) ([\w.]+)/.exec(navigator.userAgent);if(f){if((f[1]||"")=='msie'&&(f[2]||"0")<7){s=$('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:b,top:yPos,zIndex:99,width:w,height:h}).insertBefore(n)}}n.fadeIn(500);if(p){p.remove();p=null}v=(k.outerWidth()/t.width)*n.width();ch=(k.outerHeight()/t.height)*n.height();p=i.append(format("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",v,ch)).find(':last');o.css('cursor',p.css('cursor'));var g=false;if(j.tint){p.css('background','url("'+k.attr('src')+'")');q=i.append(format('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',k.outerWidth(),k.outerHeight(),j.tint)).find(':last');q.css('opacity',j.tintOpacity);g=true;q.fadeIn(500)}if(j.softFocus){p.css('background','url("'+k.attr('src')+'")');r=i.append(format('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',k.outerWidth()-2,k.outerHeight()-2,j.tint)).find(':last');r.css('background','url("'+k.attr('src')+'")');r.css('opacity',0.5);g=true;r.fadeIn(500)}if(!g){p.css('opacity',j.lensOpacity)}if(j.position!=='inside'){p.fadeIn(500)}zw.controlLoop();return})};l=new Image();$(l).load(function(){F.init2(this,0)});l.src=k.attr('src');m=new Image();$(m).load(function(){F.init2(this,1)});m.src=i.attr('href')}$.fn.CloudZoom=function(d){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}this.each(function(){var c,opts;eval('var    a = {'+$(this).attr('rel')+'}');c=a;if($(this).is('.cloud-zoom')){opts=$.extend({},$.fn.CloudZoom.defaults,d);opts=$.extend({},opts,c);$(this).css({'position':'relative','display':'block'});$('img',$(this)).css({'display':'block'});if(!$(this).parent().hasClass('cloud-zoom-wrap')&&opts.useWrapper){$(this).wrap('<div class="cloud-zoom-wrap"></div>')}$(this).data('zoom',new CloudZoom($(this),opts))}else if($(this).is('.cloud-zoom-gallery')){opts=$.extend({},c,d);$(this).data('relOpts',opts);$(this).bind('click',$(this),function(a){var b=a.data.data('relOpts');$('#'+b.useZoom).data('zoom').destroy();$('#'+b.useZoom).attr('href',a.data.attr('href'));$('#'+b.useZoom+' img').attr('src',a.data.data('relOpts').smallImage);$('#'+a.data.data('relOpts').useZoom).CloudZoom();return false})}});return this};$.fn.CloudZoom.defaults={zoomWidth:'auto',zoomHeight:'auto',position:'right',transparentImage:'.',useWrapper:true,tint:false,tintOpacity:0.5,lensOpacity:0.5,softFocus:false,smoothMove:3,showTitle:true,titleOpacity:0.5,adjustX:0,adjustY:0}})(jQuery);

